<UserControl x:Class="HospitalManagementSystem.Doctor.Views.SurgeriesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:local="clr-namespace:HospitalManagementSystem"
             xmlns:loc="clr-namespace:HospitalManagementSystem.Utils"
             Background="{DynamicResource MaterialDesignPaper}"
             mc:Ignorable="d">

    <!-- ESC to go back -->
    <UserControl.InputBindings>
        <KeyBinding Key="Escape"
                    Command="{Binding DataContext.GoToDashboardCommand,
                                      RelativeSource={RelativeSource AncestorType=Window}}"/>
    </UserControl.InputBindings>
    <materialDesign:DialogHost
        IsOpen="{Binding IsNursePickerOpen}"
        CloseOnClickAway="True"
        Background="{DynamicResource MaterialDesign.Brush.DialogHost.Background}">

    <DockPanel>

        <!-- BACK BAR -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource MaterialDesign.Brush.Surface}"
                BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}"
                BorderThickness="0,0,0,1"
                Padding="8,6">
            <StackPanel Orientation="Horizontal">
                <Button Style="{DynamicResource MaterialDesignFlatButton}"
                        Click="GoToDashboard">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ArrowLeft" Width="18" Height="18" Margin="0,0,8,0"/>
                        <TextBlock Text="{loc:Loc backToDashboard}"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Border>

        <!-- TOP TOOLBAR (responsive grid; no Save/Print) -->
        <Border DockPanel.Dock="Top" 
                Background="{DynamicResource MaterialDesign.Brush.Surface}"
                BorderBrush="{DynamicResource MaterialDesign.Brush.Divider}"
                BorderThickness="0,0,0,1"
                Padding="8,6">
            <Grid VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>              <!-- Schedule -->
                    <ColumnDefinition Width="16"/>                <!-- spacer -->
                    <ColumnDefinition Width="Auto"/>              <!-- magnify -->
                    <ColumnDefinition Width="3*" MinWidth="200"/> <!-- search grows -->
                    <ColumnDefinition Width="16"/>                <!-- spacer -->
                    <ColumnDefinition Width="2*" MinWidth="140"/> <!-- From -->
                    <ColumnDefinition Width="2*" MinWidth="140"/> <!-- To -->
                    <ColumnDefinition Width="Auto"/>              <!-- Status lbl -->
                    <ColumnDefinition Width="1.5*" MinWidth="140"/> <!-- Status -->
                    <ColumnDefinition Width="Auto"/>              <!-- Surgeon lbl -->
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Content="{loc:Loc newBtn}"
                        Command="{Binding ScheduleSurgeryCommand}"
                        Style="{DynamicResource MaterialDesignFlatButton}"/>

                <materialDesign:PackIcon Grid.Column="2" Kind="Magnify"
                                         Height="20" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Grid.Column="3"
                         HorizontalAlignment="Stretch"
                         materialDesign:HintAssist.Hint="{loc:Loc searchSurgeries}"
                         materialDesign:HintAssist.IsFloating="False"
                         materialDesign:TextFieldAssist.HasClearButton="True"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Style="{DynamicResource MaterialDesignOutlinedTextBox}"/>

                <DatePicker Grid.Column="5"
                            HorizontalAlignment="Stretch"
                            materialDesign:HintAssist.Hint="{loc:Loc fromDate}"
                            materialDesign:HintAssist.IsFloating="False"
                            SelectedDate="{Binding SearchStartDate, UpdateSourceTrigger=PropertyChanged}"
                            Style="{DynamicResource MaterialDesignOutlinedDatePicker}"/>
                <DatePicker Grid.Column="6" Margin="8,0,0,0"
                            HorizontalAlignment="Stretch"
                            materialDesign:HintAssist.Hint="{loc:Loc toDate}"
                            materialDesign:HintAssist.IsFloating="False"
                            SelectedDate="{Binding SearchEndDate, UpdateSourceTrigger=PropertyChanged}"
                            Style="{DynamicResource MaterialDesignOutlinedDatePicker}"/>

                <TextBlock Grid.Column="7" Text="Status:"
                           VerticalAlignment="Center" Margin="12,0,6,0"
                           Foreground="{DynamicResource MaterialDesign.Brush.OnSurfaceVariant}"/>
                <ComboBox Grid.Column="8"
                          ItemsSource="{Binding SurgeryStatuses}"
                          SelectedItem="{Binding SelectedStatusFilter}"
                          Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                          materialDesign:HintAssist.Hint="{loc:Loc allStatuses}"
                          SelectedValuePath="Content"
                          SelectedValue="{Binding SearchStatus}"
                          materialDesign:HintAssist.IsFloating="False">
                <ComboBoxItem>Scheduled</ComboBoxItem>
                <ComboBoxItem>Cancelled</ComboBoxItem>
                <ComboBoxItem>Completed</ComboBoxItem>
                <ComboBoxItem>Preparing</ComboBoxItem>
                <ComboBoxItem>Aborted</ComboBoxItem>
                <ComboBoxItem>Complications</ComboBoxItem>
                <ComboBoxItem>Recovery</ComboBoxItem>
                <ComboBoxItem>Follow-up needed</ComboBoxItem>
                </ComboBox>
                <Border Grid.Column="9" VerticalAlignment="Bottom" Margin="5,0,0,10">
                    <Button Content="{loc:Loc cancelBtn}"
                            Style="{DynamicResource MaterialDesignFlatButton}"
                            Command="{Binding ClearFiltersCommand}"/>
                </Border>
            </Grid>
        </Border>

        <!-- PATIENT BANNER -->
        <materialDesign:Card materialDesign:ElevationAssist.Elevation="Dp4" DockPanel.Dock="Top" Margin="10" VerticalContentAlignment="Center" UniformCornerRadius="12" Padding="5">
        <local:PatientBasicInfo DockPanel.Dock="Top"/>
        </materialDesign:Card>
        

        <!-- MAIN: LIST (left) / DETAILS (right) -->
        <Grid Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="2.5*"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Surgeries list -->
            <materialDesign:Card Grid.Column="0"
                                 Padding="20"
                                 UniformCornerRadius="12"
                                 Margin="10,0,5,0"
                                 materialDesign:ElevationAssist.Elevation="Dp8">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0"
                               Text="{loc:Loc surgeries}" 
                               FontSize="16" FontWeight="SemiBold"
                               Margin="0,0,0,17"
                               Foreground="{DynamicResource MaterialDesign.Brush.OnSurface}" />

                    <DataGrid Grid.Row="1"
                              Style="{DynamicResource MaterialDesignDataGrid}"
                              Margin="10,0"
                              AutoGenerateColumns="False"
                              ItemsSource="{Binding SurgeriesView}"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                             >
                        <DataGrid.Columns>
                            <DataGridTextColumn CellStyle="{DynamicResource MaterialDesignDataGridCell}"
                                                Header="{loc:Loc date}" Binding="{Binding date}" Width="*"/>
                            <DataGridTextColumn CellStyle="{DynamicResource MaterialDesignDataGridCell}"
                                                Header="{loc:Loc surgeon}" Binding="{Binding surgeon.employee.name }" Width="*"/>
                            <DataGridTextColumn CellStyle="{DynamicResource MaterialDesignDataGridCell}"
                                                Header="{loc:Loc procedure}" Binding="{Binding procedure}" Width="2*"/>
                            <DataGridTextColumn CellStyle="{DynamicResource MaterialDesignDataGridCell}"
                                                Header="{loc:Loc room}" Binding="{Binding room.number}" Width="*"/>
                            <DataGridTextColumn CellStyle="{DynamicResource MaterialDesignDataGridCell}"
                                                Header="Status" Binding="{Binding status}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </materialDesign:Card>

            <!-- RIGHT: Surgery details / schedule -->
            <!--<materialDesign:Card Grid.Column="1"
                                 Padding="20"
                                 Margin="5,0,10,0"
                                 UniformCornerRadius="12"
                                 materialDesign:ElevationAssist.Elevation="Dp8"
                                 >
                ~1~ Scroll when space is tight @1@
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              CanContentScroll="True"
                              Focusable="False">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>  ~1~ 0: title @1@
                            <RowDefinition Height="Auto"/>  ~1~ 1: date/time/duration @1@
                            <RowDefinition Height="Auto"/>  ~1~ 2: procedure @1@
                            <RowDefinition Height="Auto"/>  ~1~ 3: type/priority @1@
                            <RowDefinition Height="Auto"/>  ~1~ 4: status/room @1@
                            <RowDefinition Height="Auto"/>  ~1~ 5: surgeon/assistant @1@
                            <RowDefinition Height="Auto"/>  ~1~ 6: anesth / anesthesia type @1@
                            <RowDefinition Height="Auto"/>  ~1~ 7: pre-op diag @1@
                            <RowDefinition Height="Auto"/>  ~1~ 8: post-op diag @1@
                            <RowDefinition Height="*"/>     ~1~ 9: notes (grows/shrinks) @1@
                            <RowDefinition Height="Auto"/>  ~1~ 10: buttons @1@
                        </Grid.RowDefinitions>

                        <TextBlock Grid.ColumnSpan="2" Text="Surgery Details"
                                   FontSize="16" FontWeight="SemiBold" Margin="0,0,0,17"/>

                        ~1~ Date / Time / Duration @1@
                        <Grid Grid.Row="1" Grid.ColumnSpan="2" Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            ~1~ Date @1@
                            <DatePicker Grid.Column="0"
                                        HorizontalAlignment="Stretch" MinWidth="180"
                                        Style="{DynamicResource MaterialDesignFilledDatePicker}"
                                        Margin="0,0,5,0"
                                        materialDesign:TextFieldAssist.TextFieldCornerRadius="6" 
                                        materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                        materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                        materialDesign:HintAssist.Hint="Date"
                                        materialDesign:HintAssist.IsFloating="False"
                                        SelectedDate="{Binding DraftSurgery.Date, Mode=TwoWay}"/>

                            ~1~ Time @1@
                            <TextBox Grid.Column="1"
                                     HorizontalAlignment="Stretch" MinWidth="140"
                                     Style="{DynamicResource MaterialDesignFilledTextBox}"
                                     materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                     Margin="5,0,5,0"
                                     materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                     materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                     materialDesign:HintAssist.Hint="Time (HH:mm)"
                                     materialDesign:HintAssist.IsFloating="False"
                                     Text="{Binding DraftSurgery.Time, Mode=TwoWay}"/>

                            ~1~ Duration @1@
                            
                            <TextBox Grid.Column="2"
                                     HorizontalAlignment="Stretch" MinWidth="140"
                                     Style="{DynamicResource MaterialDesignFilledTextBox}"
                                     materialDesign:TextFieldAssist.TextFieldCornerRadius="6" 
                                     Margin="5,0,0,0"
                                     materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                     materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                     materialDesign:HintAssist.Hint="Duration (min)"
                                     materialDesign:HintAssist.IsFloating="False"
                                     Text="{Binding DraftSurgery.DurationMinutes, Mode=TwoWay}"/>
                        </Grid>

                        ~1~ <TextBox Grid.Row="1" Grid.Column="1" Width="140" @1@
                        ~1~          Style="{DynamicResource MaterialDesignFilledTextBox}" @1@
                        ~1~          materialDesign:TextFieldAssist.TextFieldCornerRadius="6"  @1@
                        ~1~          materialDesign:TextFieldAssist.HasOutlinedTextField="True" @1@
                        ~1~          materialDesign:TextFieldAssist.RippleOnFocusEnabled="True" @1@
                        ~1~          materialDesign:HintAssist.Hint="Duration (min)" @1@
                        ~1~          materialDesign:HintAssist.IsFloating="False" @1@
                        ~1~          Text="{Binding DraftSurgery.DurationMinutes, Mode=TwoWay}"/> @1@

                        ~1~ Procedure @1@
                        <TextBox Grid.Row="2" Grid.ColumnSpan="2"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6" 
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.Hint="Procedure"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Margin="0,0,0,10"
                                 Text="{Binding DraftSurgery.Procedure, Mode=TwoWay}"/>

                        ~1~ Type / Priority @1@
                        <ComboBox Grid.Row="3" Grid.Column="0"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Surgery type"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="0,0,8,10"
                                  ItemsSource="{Binding SurgeryTypes}"
                                  SelectedItem="{Binding DraftSurgery.Type, Mode=TwoWay}"/>
                        <ComboBox Grid.Row="3" Grid.Column="1"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Priority"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="8,0,0,10"
                                  ItemsSource="{Binding Priorities}"
                                  SelectedItem="{Binding DraftSurgery.Priority, Mode=TwoWay}"/>

                        ~1~ Status / Room @1@
                        <ComboBox Grid.Row="4" Grid.Column="0"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Status"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="0,0,8,10"
                                  ItemsSource="{Binding SurgeryStatuses}"
                                  SelectedItem="{Binding DraftSurgery.Status, Mode=TwoWay}"/>
                        <ComboBox Grid.Row="4" Grid.Column="1"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Operating room"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="8,0,0,10"
                                  ItemsSource="{Binding Rooms}"
                                  SelectedItem="{Binding DraftSurgery.Room, Mode=TwoWay}"/>

                        ~1~ Surgeon / Assistant @1@
                        <ComboBox Grid.Row="5" Grid.Column="0"
                                  IsEditable="True" StaysOpenOnEdit="True" IsTextSearchEnabled="False"
                                  ItemsSource="{Binding Surgeons}"
                                  Text="{Binding DraftSurgery.Surgeon, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Surgeon"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="0,0,8,10"/>
                        <ComboBox Grid.Row="5" Grid.Column="1"
                                  IsEditable="True" StaysOpenOnEdit="True" IsTextSearchEnabled="False"
                                  ItemsSource="{Binding Assistants}"
                                  Text="{Binding DraftSurgery.Assistant, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Assistant"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="8,0,0,10"/>

                        ~1~ Anesthesiologist / Anesthesia type @1@
                        <ComboBox Grid.Row="6" Grid.Column="0"
                                  IsEditable="True" StaysOpenOnEdit="True" IsTextSearchEnabled="False"
                                  ItemsSource="{Binding Anesthesiologists}"
                                  Text="{Binding DraftSurgery.Anesthesiologist, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Anesthesiologist"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="0,0,8,10"/>
                        <ComboBox Grid.Row="6" Grid.Column="1"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="Anesthesia type"
                                  materialDesign:HintAssist.IsFloating="False"
                                  Margin="8,0,0,10"
                                  ItemsSource="{Binding AnesthesiaTypes}"
                                  SelectedItem="{Binding DraftSurgery.AnesthesiaType, Mode=TwoWay}"/>

                        ~1~ Pre-op / Post-op @1@
                        <TextBox Grid.Row="7" Grid.ColumnSpan="2"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6" 
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.Hint="Pre-op diagnosis"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Margin="0,0,0,10"
                                 Text="{Binding DraftSurgery.PreOpDiagnosis, Mode=TwoWay}"/>

                        <TextBox Grid.Row="8" Grid.ColumnSpan="2"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6" 
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.Hint="Post-op diagnosis"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Margin="0,0,0,10"
                                 Text="{Binding DraftSurgery.PostOpDiagnosis, Mode=TwoWay}"/>

                        ~1~ Notes (grows/shrinks; scrolls when tight) @1@
                        <TextBox Grid.Row="9" Grid.ColumnSpan="2"
                                 AcceptsReturn="True" TextWrapping="Wrap"
                                 VerticalAlignment="Stretch" MinHeight="120"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6" 
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.Hint="Notes"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Margin="0,0,0,10"
                                 Text="{Binding DraftSurgery.Notes, Mode=TwoWay}"/>

                        ~1~ Buttons (no Save) @1@
                        <StackPanel Grid.Row="10" Grid.ColumnSpan="2"
                                    Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                            <Button Content="Cancel" Style="{DynamicResource MaterialDesignFlatButton}" />
                            <Button Content="Schedule" Margin="8,0,0,0"
                                    Style="{DynamicResource MaterialDesignRaisedButton}" />
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </materialDesign:Card>-->
            <materialDesign:Card Grid.Column="1" Margin="10"
                                 Padding="20" UniformCornerRadius="12"
                                 materialDesign:ElevationAssist.Elevation="Dp8">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>  <!-- title -->
                            <RowDefinition Height="Auto"/>  <!-- patient -->
                            <RowDefinition Height="Auto"/>  <!-- date/time -->
                            <RowDefinition Height="Auto"/>  <!-- duration -->
                            <RowDefinition Height="Auto"/>  <!-- room -->
                            <RowDefinition Height="Auto"/>  <!-- nurses -->
                            <RowDefinition Height="Auto"/>  <!-- procedure -->
                            <RowDefinition Height="*"/>     <!-- notes -->
                            <RowDefinition Height="Auto"/>  <!-- buttons -->
                        </Grid.RowDefinitions>

                        <!-- Title -->
                        <TextBlock Grid.ColumnSpan="2"
                                   Text="{loc:Loc scheduleSurgery}"
                                   FontSize="16" FontWeight="SemiBold" Margin="0,0,0,6"/>

                        <!-- Patient -->
                        <ComboBox Grid.Row="1" Grid.ColumnSpan="2"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="{loc:Loc surgeon}"
                                  materialDesign:HintAssist.IsFloating="False"
                                  ItemsSource="{Binding Surgeons}"
                                  IsTextSearchEnabled="True"
                                  IsEnabled="{Binding IsControlsEnabled}"
                                  SelectedItem="{Binding SelectedSurgeon, Mode=TwoWay}"
                                  Margin="0,0,0,10">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding employee.name}"></TextBlock>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <!-- Date & Time -->
                        <Grid Grid.Row="2" Grid.ColumnSpan="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <DatePicker Grid.Column="0"
                                        Style="{DynamicResource MaterialDesignFilledDatePicker}"
                                        materialDesign:HintAssist.Hint="{loc:Loc date}"
                                        materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                        materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                        materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                        materialDesign:HintAssist.IsFloating="False"
                                        Margin="0, 0, 5, 10"
                                        IsEnabled="{Binding IsControlsEnabled}"
                                        SelectedDate="{Binding SelectedSurgeryDate}"/>

                            <TextBox Grid.Column="1"
                                     Style="{DynamicResource MaterialDesignFilledTextBox}"
                                     materialDesign:HintAssist.Hint="{loc:Loc time}"
                                     materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                     materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                     materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                     materialDesign:HintAssist.IsFloating="False"
                                     Margin="5, 0, 0, 10"
                                     IsEnabled="{Binding IsControlsEnabled}"
                                     PreviewTextInput="TimeBox_PreviewTextInput"
                                     TextChanged="TimeBox_TextChanged"
                                     PreviewKeyDown="TimeBox_PreviewKeyDown"
                                     Text="{Binding SelectedSurgeryTime}"/>
                        </Grid>

                        <!-- Duration -->
                        <TextBox Grid.Row="3" Grid.ColumnSpan="2"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.IsFloating="False"
                                 materialDesign:HintAssist.Hint="{loc:Loc durationMin}"
                                 IsEnabled="{Binding IsControlsEnabled}"
                                 Margin="0,0,0,10"
                                 Text="{Binding SelectedSurgeryDuration}"/>

                        <!-- Room -->
                        <ComboBox Grid.Row="4" Grid.ColumnSpan="2"
                                  Style="{DynamicResource MaterialDesignOutlinedComboBox}"
                                  materialDesign:HintAssist.Hint="{loc:Loc room}"
                                  materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                  materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                  materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                  materialDesign:HintAssist.IsFloating="False"
                                  ItemsSource="{Binding Rooms}"
                                  Margin="0,0,0,10"
                                  IsEnabled="{Binding IsControlsEnabled}"
                                  SelectedItem="{Binding SelectedRoom}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding number}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <!-- Nurses (chips + open dialog button) -->
                        <StackPanel Grid.Row="5" Grid.ColumnSpan="2" Margin="0,0,0,10">
                            <TextBlock Text="{loc:Loc nurses}"
                                       FontSize="14" FontWeight="SemiBold" Margin="0,0,0,6"/>
                            <Border Padding="8" CornerRadius="6"
                                    Background="{DynamicResource MaterialDesign.Brush.Surface}"
                                    BorderBrush="{DynamicResource MaterialDesign.Brush.Outline}"
                                    BorderThickness="1">
                                <Grid Margin="0,0,0,10">
                                    <!-- Chips -->
                                    <ItemsControl ItemsSource="{Binding SelectedNurses}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel ItemHeight="32" ItemWidth="Auto"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <materialDesign:Chip
                                                    Content="{Binding FullName}"
                                                    IsDeletable="True"
                                                   Margin="4,0,4,0"
                                                    DeleteCommand="{Binding DataContext.RemoveNurseCommand,
                                                                            RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    DeleteCommandParameter="{Binding}"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Hint -->
                                    <TextBlock Text="{loc:Loc selectNurses}"
                                               Opacity=".6"
                                               IsHitTestVisible="False"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Center"
                                               Margin="4,0,0,10">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding SelectedNurses.Count}" Value="0">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Grid>
                            </Border>

                            <Button Margin="0,8,0,0"
                                        IsEnabled="{Binding IsControlsEnabled}"
                                        Content="{loc:Loc pickNurses}"
                                    Style="{DynamicResource MaterialDesignOutlinedButton}"
                                    Command="{Binding OpenNursePickerCommand}">
                            </Button>
                        </StackPanel>

                        <!-- Procedure -->
                        <TextBox Grid.Row="6" Grid.ColumnSpan="2"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Margin="0,0,0,10"
                                 materialDesign:HintAssist.Hint="{loc:Loc procedure}"
                                 IsEnabled="{Binding IsControlsEnabled}"
                                 Text="{Binding SelectedSurgery.procedure}"/>

                        <!-- Notes -->
                        <TextBox Grid.Row="7" Grid.ColumnSpan="2"
                                 AcceptsReturn="True" TextWrapping="Wrap"
                                 VerticalAlignment="Stretch" MinHeight="140"
                                 Style="{DynamicResource MaterialDesignFilledTextBox}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Margin="0,0,0,10"
                                 IsEnabled="{Binding IsControlsEnabled}"
                                 materialDesign:HintAssist.Hint="{loc:Loc notes}"
                                 Text="{Binding SelectedSurgery.notes}"/>

                        <materialDesign:Snackbar Grid.Row="8" Grid.Column="0" 
                                                 MessageQueue="{Binding MessageQueue}"
                                                 HorizontalAlignment="Center"
                                                 VerticalAlignment="Bottom"
                                                 HorizontalContentAlignment="Center"
                                                 Padding="0"
                                         
                                                 Background="{DynamicResource MaterialDesignPaper}"
                                                 Foreground="{DynamicResource MaterialDesignBody}"
                        >
                            <materialDesign:Snackbar.Resources>
                                <Style TargetType="ContentPresenter">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                </Style>
                                <Style TargetType="Grid">
                                    <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                </Style>
                            </materialDesign:Snackbar.Resources>
                        </materialDesign:Snackbar>
                        <!-- Actions -->
                        <StackPanel Grid.Row="8" Grid.ColumnSpan="2"
                                    Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="{loc:Loc cancelBtn}" IsEnabled="{Binding IsControlsEnabled}" Style="{DynamicResource MaterialDesignFlatButton}"/>
                            <Button Content="{loc:Loc saveBtn}" IsEnabled="{Binding IsControlsEnabled}"
                                    Style="{DynamicResource MaterialDesignRaisedButton}"
                                    Margin="8,0,0,0"
                                    Command="{Binding SaveSurgeryCommand}"/>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </materialDesign:Card>
        </Grid>
        
    </DockPanel>
         <materialDesign:DialogHost.DialogContent>
            <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Margin="16">
                <materialDesign:Card Padding="16" UniformCornerRadius="12" Width="440"
                                     materialDesign:ElevationAssist.Elevation="Dp8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>  <!-- title -->
                            <RowDefinition Height="Auto"/>  <!-- search -->
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="*"/>     <!-- list -->
                            <RowDefinition Height="16"/>
                            <RowDefinition Height="Auto"/>  <!-- actions -->
                        </Grid.RowDefinitions>

                        <TextBlock Text="{loc:Loc selectNurses}"
                                   FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>

                        <!-- Search -->
                        <TextBox Grid.Row="1"
                                 Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                 materialDesign:HintAssist.Hint="{loc:Loc searchNurses}"
                                 materialDesign:TextFieldAssist.TextFieldCornerRadius="6"
                                 materialDesign:TextFieldAssist.HasOutlinedTextField="True"
                                 materialDesign:TextFieldAssist.RippleOnFocusEnabled="True"
                                 materialDesign:HintAssist.IsFloating="False"
                                 Text="{Binding NurseFilterText, UpdateSourceTrigger=PropertyChanged}"/>

                        <!-- List -->
                        <ScrollViewer Grid.Row="3" MaxHeight="360">
                            <ItemsControl ItemsSource="{Binding NursesView}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox Content="{Binding FullName}"
                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                  Style="{StaticResource MaterialDesignCheckBox}"
                                                  Margin="4,4"/>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Actions -->
                        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Margin="0,0,8,0"
                                    Style="{DynamicResource MaterialDesignOutlinedButton}"
                                    Content="{loc:Loc cancelBtn}"
                                    Command="{Binding CancelNursePickerCommand}">
                            </Button>
                            <Button Style="{DynamicResource MaterialDesignRaisedButton}"
                                    Content="{loc:Loc saveBtn}"
                                    Command="{Binding ApplyNursePickerCommand}">
                            </Button>
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>
            </Grid>
        </materialDesign:DialogHost.DialogContent>
        </materialDesign:DialogHost>
</UserControl>
